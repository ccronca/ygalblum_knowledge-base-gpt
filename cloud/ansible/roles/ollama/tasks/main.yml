- name: Verify all required parameters were set
  delegate_to: localhost
  run_once: true
  block:
  - name: Verify ollama_ingest_google_drive_folder_id was set
    ansible.builtin.assert:
      that: ollama_ingest_google_drive_folder_id | default("") | length > 0
      fail_msg: "Make sure to set ollama_ingest_google_drive_folder_id"
  - name: Slackbot checks
    when: ollama_provision_slackbot
    block:
    - name: Verify ollama_slack_app_token was set
      ansible.builtin.assert:
        that: ollama_slack_app_token | default("") | length > 0
        fail_msg: "Make sure to set ollama_slack_app_token"
    - name: Verify ollama_slack_bot_token was set
      ansible.builtin.assert:
        that: ollama_slack_bot_token | default("") | length > 0
        fail_msg: "Make sure to set ollama_slack_bot_token"
    - name: Verify ollama_forward_question_channel_name was set
      ansible.builtin.assert:
        that: ollama_forward_question_channel_name | default("") | length > 0
        fail_msg: "Make sure to set ollama_forward_question_channel_name"

- name: Installations
  ansible.builtin.include_tasks:
    file: install.yml
    apply:
      become: true

- name: Provision Ollama
  ansible.builtin.include_tasks:
    file: setup_ollama.yml
    apply:
      become: false

- name: Provision secured port
  when: ollama_expose_secured_port
  ansible.builtin.include_tasks:
    file: setup_secure_ollama.yml
    apply:
      become: false

- name: Provision Ingest
  when: ollama_provision_slackbot or ollama_provision_ui
  ansible.builtin.include_tasks:
    file: setup_ingest.yml
    apply:
      become: false

- name: Provision SlackBot
  when: ollama_provision_slackbot
  ansible.builtin.include_tasks:
    file: setup_slackbot.yml
    apply:
      become: false

- name: Provision SlackBot
  when: ollama_provision_ui
  ansible.builtin.include_tasks:
    file: setup_gradio.yml
    apply:
      become: false
